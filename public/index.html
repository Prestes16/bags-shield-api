<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Bags Shield API — Status & Playground</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Ícone e Open Graph -->
  <link rel="icon" type="image/png" href="/assets/bags-shield-icon.png" />
  <meta property="og:image" content="/assets/bags-shield-icon.png" />

  <style>
    :root {
      /* Paleta navy/azul Bags Shield */
      --bg-main: #020617;
      --bg-card: #050b1c;
      --bg-card-soft: #071330;
      --accent: #2fa7ff;
      --accent-soft: #4dd4ff;
      --accent-green: #1fe39b;
      --accent-yellow: #ffc94d;
      --danger: #ff4d7d;
      --text-main: #f7f9ff;
      --text-soft: #c4d4ff;
      --border-soft: rgba(70, 110, 190, 0.8);
      --muted: #7b88c2;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.6);
      --radius-lg: 20px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, -apple-system, "SF Pro Text", sans-serif;
      background:
        radial-gradient(140% 220% at 0% 0%, #132457 0%, transparent 55%),
        radial-gradient(160% 220% at 100% 0%, #0b1537 0%, #020617 55%, #000000 100%);
      color: var(--text-main);
      min-height: 100vh;
      padding: 24px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      overflow-x: hidden;
    }

    .app-shell {
      width: min(1120px, 100%);
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    /* CHUVA DE $ NO FUNDO */
    .dollar-rain {
      position: fixed;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 0;
      mix-blend-mode: screen;
      transform: translate3d(0, 0, 0);
      transition: transform 0.18s ease-out;
    }

    .dollar {
      position: absolute;
      top: -10%;
      color: rgba(77, 212, 255, 0.22);
      text-shadow:
        0 0 8px rgba(77, 212, 255, 0.7),
        0 0 18px rgba(47, 147, 255, 0.5);
      font-weight: 600;
      animation-name: dollar-fall;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      will-change: transform, opacity;
    }

    @keyframes dollar-fall {
      0% {
        transform: translate3d(var(--x-offset, 0px), -120%, 0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      100% {
        transform: translate3d(var(--x-offset, 0px), 120%, 0) rotate(18deg);
        opacity: 0;
      }
    }

    header.app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 24px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-logo-wrap {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      padding: 4px;
      background: radial-gradient(circle at 0% 0%, #4dd4ff 0%, #2fa7ff 40%, #020617 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 1px rgba(77, 212, 255, 0.3);
      overflow: hidden;
    }

    .brand-logo {
      width: 100%;
      height: 100%;
      border-radius: 10px;
      object-fit: cover;
      display: block;
      background: #020617;
    }

    /* Fallback se a imagem quebrar */
    .brand-logo-wrap.fallback-logo {
      background: radial-gradient(circle at 30% 0%, #4dd4ff 0%, #2fa7ff 30%, #071330 100%);
      box-shadow:
        0 0 0 1px rgba(77, 212, 255, 0.5),
        0 0 18px rgba(77, 212, 255, 0.35);
      position: relative;
    }

    .brand-logo-wrap.fallback-logo::before {
      content: "BS";
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.9rem;
      letter-spacing: 0.06em;
      color: #020617;
    }

    .brand-text h1 {
      font-size: 1.25rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .brand-text h1 span.marker {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 500;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(47, 167, 255, 0.16);
      color: var(--accent-soft);
      border: 1px solid rgba(77, 212, 255, 0.5);
      text-transform: uppercase;
    }

    .brand-text p {
      font-size: 0.83rem;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .env-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.78rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(96, 135, 210, 0.8);
      background: linear-gradient(120deg, rgba(9, 18, 51, 0.96), rgba(3, 7, 25, 0.96));
      color: var(--text-soft);
      white-space: nowrap;
    }

    .env-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent-green);
      box-shadow: 0 0 12px rgba(31, 227, 155, 0.9);
    }

    .lang-select {
      font-size: 0.78rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(96, 135, 210, 0.8);
      background: rgba(5, 12, 36, 0.96);
      color: var(--text-soft);
      outline: none;
      cursor: pointer;
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .panel {
      background: radial-gradient(circle at 0% 0%, #152a57 0%, #050b1c 55%, #020617 100%);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 16px;
      flex: 2;
      min-width: 260px;
    }

    .panel h2 {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .panel h2 span.badge {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(31, 227, 155, 0.08);
      border: 1px solid rgba(31, 227, 155, 0.6);
      color: var(--accent-green);
      text-transform: uppercase;
    }

    .panel p {
      font-size: 0.8rem;
      color: var(--text-soft);
      line-height: 1.4;
      margin-bottom: 8px;
    }

    .base-url-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-top: 8px;
    }

    .base-url-row label {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .base-url-row input {
      flex: 1;
      min-width: 160px;
      border-radius: 999px;
      border: 1px solid rgba(102, 152, 238, 0.95);
      background: rgba(3, 8, 27, 0.96);
      padding: 7px 12px;
      font-size: 0.8rem;
      color: var(--text-main);
      outline: none;
    }

    .base-url-row input::placeholder {
      color: rgba(196, 208, 255, 0.5);
    }

    .base-url-row button {
      border-radius: 999px;
      border: none;
      padding: 7px 12px;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent-soft));
      color: #02030a;
      box-shadow:
        0 0 0 1px rgba(77, 212, 255, 0.4),
        0 12px 30px rgba(0, 0, 0, 0.7);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .base-url-row button:active {
      transform: translateY(1px);
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.75);
    }

    .hint {
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
      margin-top: 10px;
    }

    .card {
      background: radial-gradient(circle at 0% 0%, #132647 0%, #050a19 55%, #020617 100%);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(90, 138, 232, 0.9);
      padding: 14px 14px 12px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0% 0%, rgba(77, 212, 255, 0.06), transparent 55%);
      pointer-events: none;
    }

    .card-headline {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .card-title {
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .card-title span.label {
      font-size: 0.72rem;
      color: var(--muted);
    }

    .method-pill {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(90, 138, 232, 0.9);
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .method-pill[data-method="GET"] {
      border-color: rgba(77, 212, 255, 0.9);
      color: var(--accent-soft);
    }

    .method-pill[data-method="POST"] {
      border-color: rgba(255, 201, 77, 0.95);
      color: var(--accent-yellow);
    }

    .card-body {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .endpoint {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.7rem;
      padding: 4px 7px;
      border-radius: 999px;
      background: rgba(6, 12, 31, 0.98);
      border: 1px solid rgba(68, 111, 190, 0.95);
      color: var(--accent-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
      word-break: break-all;
    }

    .code-tag {
      font-size: 0.64rem;
      text-transform: uppercase;
      color: var(--muted);
      letter-spacing: 0.06em;
    }

    textarea.request-body {
      width: 100%;
      resize: vertical;
      min-height: 80px;
      max-height: 150px;
      margin-top: 6px;
      border-radius: 10px;
      border: 1px solid rgba(68, 111, 190, 0.95);
      background: rgba(3, 8, 27, 0.98);
      padding: 6px 7px;
      font-size: 0.72rem;
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: var(--text-main);
      outline: none;
    }

    .card-footer {
      margin-top: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .status-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.72rem;
      color: var(--muted);
    }

    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: rgba(123, 136, 194, 0.8);
      box-shadow: 0 0 0 rgba(0, 0, 0, 0);
      transition: background 0.18s ease, box-shadow 0.18s ease;
    }

    .status-chip[data-state="idle"] .status-dot {
      background: rgba(123, 136, 194, 0.8);
    }

    .status-chip[data-state="success"] .status-dot {
      background: var(--accent-green);
      box-shadow: 0 0 12px rgba(31, 227, 155, 0.95);
    }

    .status-chip[data-state="warn"] .status-dot {
      background: var(--accent-yellow);
      box-shadow: 0 0 10px rgba(255, 201, 77, 0.9);
    }

    .status-chip[data-state="error"] .status-dot {
      background: var(--danger);
      box-shadow: 0 0 10px rgba(255, 77, 125, 0.95);
    }

    .status-label {
      font-weight: 500;
    }

    .latency {
      font-size: 0.7rem;
      color: var(--muted);
    }

    .card-footer button {
      border-radius: 999px;
      border: none;
      padding: 6px 11px;
      font-size: 0.76rem;
      font-weight: 500;
      cursor: pointer;
      background: rgba(47, 167, 255, 0.12);
      color: var(--accent-soft);
      border: 1px solid rgba(77, 212, 255, 0.8);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .card-footer button:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .response-block {
      margin-top: 8px;
      border-radius: 10px;
      background: rgba(2, 7, 28, 0.98);
      border: 1px solid rgba(60, 102, 179, 0.98);
      padding: 6px 7px;
      max-height: 170px;
      overflow: auto;
    }

    .response-block pre {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.7rem;
      color: var(--text-main);
      white-space: pre-wrap;
      word-break: break-word;
    }

    footer {
      margin-top: 12px;
      font-size: 0.7rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    footer span strong {
      color: var(--accent-soft);
      font-weight: 500;
    }

    /* MOBILE / RESPONSIVO – “versão app” */
    @media (max-width: 880px) {
      header.app-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .header-right {
        align-self: stretch;
        justify-content: space-between;
      }

      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 640px) {
      body {
        padding: 16px 10px;
        align-items: stretch;
      }

      .app-shell {
        width: 100%;
      }

      .panel {
        padding: 14px 12px;
        border-radius: 18px;
      }

      .card {
        padding: 12px 10px 10px;
        border-radius: 16px;
      }

      .base-url-row {
        flex-direction: column;
        align-items: stretch;
      }

      .base-url-row button {
        align-self: flex-end;
        margin-top: 2px;
      }

      footer {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <!-- Fundo animado com $ -->
  <div class="dollar-rain" id="dollar-rain" aria-hidden="true"></div>

  <div class="app-shell">
    <header class="app-header">
      <div class="brand">
        <div class="brand-logo-wrap" id="brand-logo-wrap">
          <img
            src="/assets/bags-shield-icon.png"
            alt="Logo Bags Shield"
            class="brand-logo"
            onerror="this.style.display='none'; document.getElementById('brand-logo-wrap').classList.add('fallback-logo');"
          />
        </div>
        <div class="brand-text">
          <h1>
            Bags Shield API
            <span class="marker">Status & Playground</span>
          </h1>
          <p data-i18n="header.subtitle">
            Console de testes rápido para /health, /bags/ping, /scan e /simulate.
          </p>
        </div>
      </div>

      <div class="header-right">
        <div class="env-pill" id="env-pill">
          <span class="env-dot"></span>
          <span id="env-label">Carregando ambiente…</span>
        </div>

        <select class="lang-select" id="lang-select" aria-label="Language">
          <option value="pt-BR">PT-BR</option>
          <option value="en">EN</option>
        </select>
      </div>
    </header>

    <main>
      <section class="panel">
        <h2>
          <span data-i18n="panel.title">Painel de controle</span>
          <span class="badge" data-i18n="panel.badge">Live</span>
        </h2>
        <p data-i18n="panel.description">
          Use este painel para verificar se a API está saudável e se os contratos
          principais do Bags Shield (scan/simulate) estão respondendo com
          <code class="code-tag">success: true</code>.
        </p>

        <div class="base-url-row">
          <label for="base-url" data-i18n="base.label">Base URL</label>
          <input
            id="base-url"
            type="text"
            placeholder="https://bags-shield-api.vercel.app"
          />
          <button id="run-all" data-i18n="base.runAll">
            Rodar todos os testes
          </button>
        </div>
        <p class="hint" data-i18n="base.hint">
          Dica: em dev local, isso normalmente é <strong>http://localhost:3001</strong>.
          Em produção, use o domínio oficial (por exemplo, bags-shield-api.vercel.app).
        </p>

        <div class="grid">
          <!-- Card: /api/health -->
          <article
            class="card"
            data-endpoint="/api/health"
            data-method="GET"
            data-name="Health"
          >
            <div class="card-headline">
              <div class="card-title">
                <span data-i18n="card.health.title">Core — Health</span>
                <span class="label" data-i18n="card.health.label">GET /api/health</span>
              </div>
              <span class="method-pill" data-method="GET">GET</span>
            </div>
            <div class="card-body" data-i18n="card.health.body">
              Health check principal da API Bags Shield.
              <div class="endpoint">
                <span class="code-tag">Endpoint</span>
                <span>/api/health</span>
              </div>
            </div>
            <div class="card-footer">
              <div class="status-chip" data-state="idle">
                <span class="status-dot"></span>
                <span class="status-label" data-i18n="status.idle">Aguardando…</span>
                <span class="latency" data-latency></span>
              </div>
              <button class="run-btn" data-i18n="card.health.button">Testar /health</button>
            </div>
            <div class="response-block">
              <pre class="response-pre" data-i18n-placeholder="response.placeholder">Resposta aparecerá aqui…</pre>
            </div>
          </article>

          <!-- Card: /api/bags/ping -->
          <article
            class="card"
            data-endpoint="/api/bags/ping"
            data-method="GET"
            data-name="Bags Ping"
          >
            <div class="card-headline">
              <div class="card-title">
                <span data-i18n="card.ping.title">Bags Adapter — Ping</span>
                <span class="label" data-i18n="card.ping.label">GET /api/bags/ping</span>
              </div>
              <span class="method-pill" data-method="GET">GET</span>
            </div>
            <div class="card-body" data-i18n="card.ping.body">
              Verifica se o adaptador Bags está configurado e acessível.
              <div class="endpoint">
                <span class="code-tag">Endpoint</span>
                <span>/api/bags/ping</span>
              </div>
            </div>
            <div class="card-footer">
              <div class="status-chip" data-state="idle">
                <span class="status-dot"></span>
                <span class="status-label" data-i18n="status.idle">Aguardando…</span>
                <span class="latency" data-latency></span>
              </div>
              <button class="run-btn" data-i18n="card.ping.button">Testar /bags/ping</button>
            </div>
            <div class="response-block">
              <pre class="response-pre" data-i18n-placeholder="response.placeholder">Resposta aparecerá aqui…</pre>
            </div>
          </article>

          <!-- Card: /api/scan -->
          <article
            class="card"
            data-endpoint="/api/scan"
            data-method="POST"
            data-name="Scan"
          >
            <div class="card-headline">
              <div class="card-title">
                <span data-i18n="card.scan.title">Shield — Scan</span>
                <span class="label" data-i18n="card.scan.label">POST /api/scan</span>
              </div>
              <span class="method-pill" data-method="POST">POST</span>
            </div>
            <div class="card-body">
              <span data-i18n="card.scan.body">
                Analisa uma transação crua e retorna os <strong>risk badges</strong> +
                <strong>ShieldScore</strong>.
              </span>
              <div class="endpoint">
                <span class="code-tag">Endpoint</span>
                <span>/api/scan</span>
              </div>
              <textarea class="request-body" data-body>
{
  "rawTransaction": "AAECAwQF...",
  "network": "solana-devnet"
}
              </textarea>
            </div>
            <div class="card-footer">
              <div class="status-chip" data-state="idle">
                <span class="status-dot"></span>
                <span class="status-label" data-i18n="status.idle">Aguardando…</span>
                <span class="latency" data-latency></span>
              </div>
              <button class="run-btn" data-i18n="card.scan.button">Testar /scan</button>
            </div>
            <div class="response-block">
              <pre class="response-pre" data-i18n-placeholder="response.placeholder">Resposta aparecerá aqui…</pre>
            </div>
          </article>

          <!-- Card: /api/simulate -->
          <article
            class="card"
            data-endpoint="/api/simulate"
            data-method="POST"
            data-name="Simulate"
          >
            <div class="card-headline">
              <div class="card-title">
                <span data-i18n="card.simulate.title">Shield — Simulate</span>
                <span class="label" data-i18n="card.simulate.label">POST /api/simulate</span>
              </div>
              <span class="method-pill" data-method="POST">POST</span>
            </div>
            <div class="card-body">
              <span data-i18n="card.simulate.body">
                Simula um swap/ação e retorna o risco antes de assinar a transação.
              </span>
              <div class="endpoint">
                <span class="code-tag">Endpoint</span>
                <span>/api/simulate</span>
              </div>
              <textarea class="request-body" data-body>
{
  "mint": "So11111111111111111111111111111111111111112",
  "quoteLamports": 10000000,
  "side": "buy",
  "network": "solana-devnet"
}
              </textarea>
            </div>
            <div class="card-footer">
              <div class="status-chip" data-state="idle">
                <span class="status-dot"></span>
                <span class="status-label" data-i18n="status.idle">Aguardando…</span>
                <span class="latency" data-latency></span>
              </div>
              <button class="run-btn" data-i18n="card.simulate.button">Testar /simulate</button>
            </div>
            <div class="response-block">
              <pre class="response-pre" data-i18n-placeholder="response.placeholder">Resposta aparecerá aqui…</pre>
            </div>
          </article>
        </div>
      </section>

      <footer>
        <span data-i18n="footer.left">
          <strong>Bags Shield</strong> — camada nativa de confiança para memecoins na Solana.
        </span>
        <span data-i18n="footer.right">
          Console local, pensado para dev: responda dúvidas de produção com logs e smoke tests, não só com fé.
        </span>
      </footer>
    </main>
  </div>

  <script>
    (function () {
      // --- i18n: dicionário de textos ---
      const I18N = {
        "pt-BR": {
          "header.subtitle": "Console de testes rápido para /health, /bags/ping, /scan e /simulate.",
          "panel.title": "Painel de controle",
          "panel.badge": "Live",
          "panel.description": "Use este painel para verificar se a API está saudável e se os contratos principais do Bags Shield (scan/simulate) estão respondendo com success: true.",
          "base.label": "Base URL",
          "base.runAll": "Rodar todos os testes",
          "base.hint": "Dica: em dev local, isso normalmente é http://localhost:3001. Em produção, use o domínio oficial (por exemplo, bags-shield-api.vercel.app).",
          "card.health.title": "Core — Health",
          "card.health.label": "GET /api/health",
          "card.health.body": "Health check principal da API Bags Shield.",
          "card.health.button": "Testar /health",
          "card.ping.title": "Bags Adapter — Ping",
          "card.ping.label": "GET /api/bags/ping",
          "card.ping.body": "Verifica se o adaptador Bags está configurado e acessível.",
          "card.ping.button": "Testar /bags/ping",
          "card.scan.title": "Shield — Scan",
          "card.scan.label": "POST /api/scan",
          "card.scan.body": "Analisa uma transação crua e retorna os risk badges + ShieldScore.",
          "card.scan.button": "Testar /scan",
          "card.simulate.title": "Shield — Simulate",
          "card.simulate.label": "POST /api/simulate",
          "card.simulate.body": "Simula um swap/ação e retorna o risco antes de assinar a transação.",
          "card.simulate.button": "Testar /simulate",
          "status.idle": "Aguardando…",
          "status.success": "OK",
          "status.warn": "4xx",
          "status.error": "Erro",
          "response.placeholder": "Resposta aparecerá aqui…",
          "footer.left": "Bags Shield — camada nativa de confiança para memecoins na Solana.",
          "footer.right": "Console local, pensado para dev: responda dúvidas de produção com logs e smoke tests, não só com fé."
        },
        "en": {
          "header.subtitle": "Quick test console for /health, /bags/ping, /scan and /simulate.",
          "panel.title": "Control panel",
          "panel.badge": "Live",
          "panel.description": "Use this panel to verify if the API is healthy and if the core Bags Shield contracts (scan/simulate) are responding with success: true.",
          "base.label": "Base URL",
          "base.runAll": "Run all tests",
          "base.hint": "Tip: in local dev this is usually http://localhost:3001. In production, use the official domain (for example, bags-shield-api.vercel.app).",
          "card.health.title": "Core — Health",
          "card.health.label": "GET /api/health",
          "card.health.body": "Main health check for the Bags Shield API.",
          "card.health.button": "Test /health",
          "card.ping.title": "Bags Adapter — Ping",
          "card.ping.label": "GET /api/bags/ping",
          "card.ping.body": "Checks if the Bags adapter is configured and reachable.",
          "card.ping.button": "Test /bags/ping",
          "card.scan.title": "Shield — Scan",
          "card.scan.label": "POST /api/scan",
          "card.scan.body": "Scans a raw transaction and returns risk badges + ShieldScore.",
          "card.scan.button": "Test /scan",
          "card.simulate.title": "Shield — Simulate",
          "card.simulate.label": "POST /api/simulate",
          "card.simulate.body": "Simulates a swap/action and returns the risk before signing the transaction.",
          "card.simulate.button": "Test /simulate",
          "status.idle": "Waiting…",
          "status.success": "OK",
          "status.warn": "4xx",
          "status.error": "Error",
          "response.placeholder": "Response will appear here…",
          "footer.left": "Bags Shield — native trust layer for memecoins on Solana.",
          "footer.right": "Local console for devs: answer production questions with logs and smoke tests, not just hope."
        }
      };

      function applyLanguage(lang) {
        const dict = I18N[lang] || I18N["en"];
        document.documentElement.lang = lang;

        document.querySelectorAll("[data-i18n]").forEach((el) => {
          const key = el.getAttribute("data-i18n");
          if (!key) return;
          const value = dict[key];
          if (typeof value === "string") {
            el.textContent = value;
          }
        });

        document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
          const key = el.getAttribute("data-i18n-placeholder");
          if (!key) return;
          const value = dict[key];
          if (typeof value === "string") {
            el.textContent = value;
          }
        });
      }

      const baseInput = document.getElementById("base-url");
      const runAllBtn = document.getElementById("run-all");
      const envLabel = document.getElementById("env-label");
      const rainRoot = document.getElementById("dollar-rain");
      const langSelect = document.getElementById("lang-select");

      // Linguagem inicial
      let currentLang = (localStorage.getItem("bagsShieldLang") || "pt-BR");
      if (langSelect) {
        langSelect.value = currentLang;
        langSelect.addEventListener("change", () => {
          currentLang = langSelect.value || "pt-BR";
          localStorage.setItem("bagsShieldLang", currentLang);
          applyLanguage(currentLang);
        });
      }
      applyLanguage(currentLang);

      // Base inicial = origin
      try {
        baseInput.value = window.location.origin;
      } catch {
        baseInput.value = "";
      }

      function detectEnv() {
        const url = baseInput.value.trim() || window.location.origin;
        let label = "Ambiente customizado";
        if (url.includes("localhost") || url.includes("127.0.0.1")) {
          label = currentLang === "en" ? "Local dev" : "Dev local";
        } else if (url.includes("vercel.app")) {
          label = currentLang === "en" ? "Vercel / Preview" : "Preview / Vercel";
        } else if (url.includes("bags-shield-api")) {
          label = currentLang === "en" ? "Bags Shield Production" : "Produção Bags Shield";
        }
        envLabel.textContent = label + " · " + url;
      }

      detectEnv();
      baseInput.addEventListener("change", detectEnv);
      baseInput.addEventListener("blur", detectEnv);

      // CHUVA DE $: gera elementos
      (function createDollarRain() {
        if (!rainRoot) return;
        const isMobile = window.innerWidth <= 640;
        const COUNT = isMobile ? 24 : 40;

        for (let i = 0; i < COUNT; i++) {
          const span = document.createElement("span");
          span.className = "dollar";
          span.textContent = "$";

          const left = Math.random() * 100;
          const delay = Math.random() * -20;
          const duration = 12 + Math.random() * 10;
          const size = 14 + Math.random() * 10;
          const drift = (Math.random() * 40 - 20).toFixed(1) + "px";

          span.style.left = left + "%";
          span.style.animationDuration = duration + "s";
          span.style.animationDelay = delay + "s";
          span.style.fontSize = size + "px";
          span.style.setProperty("--x-offset", drift);

          rainRoot.appendChild(span);
        }

        // Parallax sutil
        window.addEventListener("pointermove", (evt) => {
          const x = (evt.clientX / window.innerWidth) - 0.5;
          const y = (evt.clientY / window.innerHeight) - 0.5;
          const tx = x * 16;
          const ty = y * 10;
          rainRoot.style.transform = `translate3d(${tx}px, ${ty}px, 0)`;
        }, { passive: true });
      })();

      async function runCard(card) {
        const endpoint = card.getAttribute("data-endpoint");
        const method = (card.getAttribute("data-method") || "GET").toUpperCase();
        const statusChip = card.querySelector(".status-chip");
        const statusLabel = card.querySelector(".status-label");
        const latencySpan = card.querySelector("[data-latency]");
        const responsePre = card.querySelector(".response-pre");
        const btn = card.querySelector(".run-btn");
        const textarea = card.querySelector(".request-body");

        const base = (baseInput.value || "").trim() || window.location.origin;
        const url = base.replace(/\/+$/, "") + endpoint;

        statusChip.setAttribute("data-state", "idle");
        statusLabel.textContent = I18N[currentLang]["status.idle"] || "Aguardando…";
        latencySpan.textContent = "";
        btn.disabled = true;

        const requestInit = {
          method,
          headers: {}
        };

        if (method === "POST" || method === "PUT" || method === "PATCH") {
          requestInit.headers["Content-Type"] = "application/json";
          const raw = textarea ? textarea.value.trim() : "";
          if (raw) {
            try {
              const parsed = JSON.parse(raw);
              requestInit.body = JSON.stringify(parsed);
            } catch (e) {
              statusChip.setAttribute("data-state", "error");
              statusLabel.textContent = I18N[currentLang]["status.error"] || "Erro";
              responsePre.textContent = String(e);
              btn.disabled = false;
              return;
            }
          } else {
            requestInit.body = "{}";
          }
        }

        const started = performance.now();
        try {
          const res = await fetch(url, requestInit);
          const elapsed = Math.round(performance.now() - started);
          latencySpan.textContent = `${elapsed} ms`;

          let bodyText = await res.text();
          let parsedBody = null;

          try {
            parsedBody = JSON.parse(bodyText);
          } catch {
            // mantém bodyText mesmo assim
          }

          const summary = {
            ok: res.ok,
            status: res.status,
            statusText: res.statusText,
            headers: Object.fromEntries(res.headers.entries()),
            body: parsedBody ?? bodyText
          };

          responsePre.textContent = JSON.stringify(summary, null, 2);

          if (res.ok) {
            statusChip.setAttribute("data-state", "success");
            statusLabel.textContent = (I18N[currentLang]["status.success"] || "OK") + " · " + res.status;
          } else if (res.status >= 400 && res.status < 500) {
            statusChip.setAttribute("data-state", "warn");
            statusLabel.textContent = (I18N[currentLang]["status.warn"] || "4xx") + " · " + res.status;
          } else {
            statusChip.setAttribute("data-state", "error");
            statusLabel.textContent = (I18N[currentLang]["status.error"] || "Erro") + " · " + res.status;
          }
        } catch (err) {
          statusChip.setAttribute("data-state", "error");
          statusLabel.textContent = I18N[currentLang]["status.error"] || "Erro";
          latencySpan.textContent = "";
          responsePre.textContent = String(err);
        } finally {
          btn.disabled = false;
        }
      }

      const cards = Array.from(document.querySelectorAll(".card"));
      cards.forEach((card) => {
        const btn = card.querySelector(".run-btn");
        if (!btn) return;
        btn.addEventListener("click", () => runCard(card));
      });

      if (runAllBtn) {
        runAllBtn.addEventListener("click", () => {
          cards.forEach((card, idx) => {
            setTimeout(() => runCard(card), idx * 200);
          });
        });
      }

      // Rodar health automaticamente na carga
      const healthCard = document.querySelector('.card[data-endpoint="/api/health"]');
      if (healthCard) {
        runCard(healthCard);
      }
    })();
  </script>
</body>
</html>

