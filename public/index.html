<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bags Shield API — Status & Confiabilidade</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#07172b; --bg-2:#0a1f3c; --card:#0e2748;
      --muted:#9fb6d5; --text:#e6f1ff;
      --blue-1:#0f68dd; --blue-2:#1ea3ff; --blue-3:#4dd4ff;
      --primary:#0f68dd; --primary-2:#1ea3ff;
      --danger:#ff4d6d; --warn:#ffb020; --ok:#47d16a;
      --shadow:0 12px 36px rgba(0,0,0,.35); --radius:20px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1600px 600px at 80% -10%, rgba(77,212,255,.16), transparent 60%),
        radial-gradient(1200px 500px at -10% 10%, rgba(30,163,255,.12), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg-2) 60%);
      min-height:100%;
      overflow-x:hidden;
      animation: bgShift 12s ease-in-out infinite;
    }
    @keyframes bgShift{
      0%{background-position:0 0,0 0,0 0}
      50%{background-position:20px -10px,-10px 10px,0 0}
      100%{background-position:0 0,0 0,0 0}
    }
    a{color:var(--blue-3);text-decoration:none}
    .wrap{max-width:1200px;margin:0 auto;padding:24px}
    .nav{display:flex;align-items:center;gap:14px}
    .logoApp{
      width:54px;height:54px;border-radius:20px;position:relative;isolation:isolate;
      background: radial-gradient(120% 120% at 30% 25%, #153863 0%, #0e2748 60%);
      box-shadow:var(--shadow); display:grid; place-items:center; overflow:hidden; border:1px solid #123a69;
    }
    .logoApp img{display:block;width:36px;height:36px}
    .logoApp .fallback{display:none}
    .logoApp img[aria-broken="1"]{display:none}
    .logoApp img[aria-broken="1"] + .fallback{display:grid}

    .brand{font-weight:800;letter-spacing:.3px}
    .tag{font-size:12px;color:var(--muted);border:1px solid #1d3557;border-radius:999px;padding:3px 10px}

    .hero{
      margin-top:28px;border-radius:var(--radius);padding:28px;
      background:linear-gradient(140deg, rgba(15,74,121,.65), rgba(14,39,72,.65));
      box-shadow:var(--shadow);
      display:grid;grid-template-columns:auto 1fr;gap:18px;align-items:center;
    }
    .heroIcon{width:84px;height:84px;border-radius:28px;background:rgba(17,48,87,.55);display:grid;place-items:center;border:1px solid #164170;position:relative;overflow:hidden}
    .heroIcon img{display:block;width:48px;height:48px}
    .heroIcon .fallback{display:none}
    .heroIcon img[aria-broken="1"]{display:none}
    .heroIcon img[aria-broken="1"] + .fallback{display:grid}

    .hero h1{margin:0 0 6px 0;font-size:30px}
    .hero p{margin:0;color:var(--muted)}
    .cta-row{margin-top:16px;display:flex;gap:12px;flex-wrap:wrap}
    .btn{appearance:none;border:0;cursor:pointer;font-weight:700;padding:12px 18px;border-radius:14px;transition:.15s transform,.15s opacity,.25s box-shadow;position:relative;overflow:hidden}
    .btn:hover{transform:translateY(-1px)}
    .btn-primary{color:#eaf4ff;background:linear-gradient(90deg, var(--primary) 0%, var(--primary-2) 100%);box-shadow:0 10px 24px rgba(30,163,255,.25), inset 0 0 0 1px rgba(255,255,255,.06);border:1px solid rgba(0,0,0,.15)}
    .btn-ghost{background:#0a2447;color:var(--blue-3);border:1px solid #12315a}
    .btn-outline{background:transparent;color:var(--blue-3);border:1px solid #1b3b66}

    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:18px;margin-top:22px}
    .card{grid-column: span 12;background:linear-gradient(180deg,rgba(20,54,96,.55),rgba(8,29,55,.7));border:1px solid #113057;border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)}
    .card h3{margin:0 0 8px 0;font-size:16px}
    .pill{font-size:12px;border:1px solid #13406f;background:#0a2447;color:#cfe8ff;border-radius:999px;padding:6px 10px}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px;font-weight:700}
    .b-ok{background:rgba(71,209,106,.12);color:#47d16a;border:1px solid rgba(71,209,106,.35)}
    .b-warn{background:rgba(255,176,32,.12);color:#ffcc66;border:1px solid rgba(255,176,32,.35)}
    .b-err{background:rgba(255,77,109,.12);color:#ff7e95;border:1px solid rgba(255,77,109,.35)}
    pre{white-space:pre-wrap;word-break:break-word;background:#061427;border:1px solid #13325b;border-radius:12px;padding:10px;font-size:13px;max-height:360px;overflow:auto;margin:0}
    input,textarea{width:100%;background:#061427;color:var(--text);border:1px solid #13325b;border-radius:12px;padding:10px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:13px;outline:none}
    input:focus,textarea:focus{box-shadow: inset 0 0 0 1px var(--primary-2)}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .ghost{opacity:.9}
    .footer{margin:26px 0 10px 0;color:#6f87a7;font-size:12px;text-align:center}

    .reliability{display:grid;grid-template-columns:330px 1fr;gap:16px;align-items:center}
    .donutwrap{display:grid;place-items:center;position:relative}
    .donut-value{font-size:34px;font-weight:800}
    .donut-sub{font-size:12px;color:#9fb6d5;margin-top:2px}
    .bar{display:grid;grid-template-columns:190px 1fr 52px;gap:10px;align-items:center;margin:10px 0}
    .bar .name{color:#cfe8ff}
    .bar .track{height:12px;border-radius:999px;background:#0a2447;border:1px solid #14335c;overflow:hidden}
    .bar .fill{height:100%;border-radius:999px;background:linear-gradient(90deg,#1ea3ff,#4dd4ff);transition:width .6s cubic-bezier(.2,.7,.2,1)}
    .bar .pct{font-variant-numeric:tabular-nums;color:#a7c6e8}

    @media (max-width: 920px){ .reliability{grid-template-columns:1fr} .bar{grid-template-columns:1fr 1fr 52px} }
    @media (max-width: 480px){ #donut{width:190px;height:190px} .hero h1{font-size:26px} }
    @media (min-width: 860px){ .card.span-7{grid-column: span 7} .card.span-5{grid-column: span 5} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="nav">
      <div class="logoApp" aria-label="Bags Shield logo">
        <img src="/assets/brand/logo-shield.png" alt="Bags Shield" width="36" height="36" onerror="this.setAttribute('aria-broken','1')"/>
        <!-- fallback SVG caso o PNG não exista -->
        <div class="fallback" aria-hidden="true">
          <svg viewBox="0 0 64 64" fill="none" role="img">
            <defs><linearGradient id="lgShield" x1="0" x2="1"><stop stop-color="#4dd4ff"/><stop offset="1" stop-color="#1ea3ff"/></linearGradient></defs>
            <path d="M32 6l18 9v13c0 11-7.6 19-18 22C21.6 47 14 39 14 28V15l18-9z" stroke="url(#lgShield)" stroke-width="3" fill="rgba(17,48,87,.55)"/>
            <path d="M25 30c0-3.8 3-6 7-6s7 2.2 7 6c0 2.6-1.3 4.6-3.4 5.6l.6 3.1H27.8l.6-3.1C26.3 34.6 25 32.6 25 30z" fill="url(#lgShield)"/>
          </svg>
        </div>
      </div>
      <div class="brand">Bags Shield API</div>
      <span class="tag">v0.2.0 • navy/blue</span>
    </div>

    <div class="hero">
      <div class="heroIcon">
        <img src="/assets/brand/logo-shield.png" alt="Bags Shield" width="48" height="48" onerror="this.setAttribute('aria-broken','1')"/>
        <div class="fallback" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none"><defs><linearGradient id="g2" x1="0" x2="1"><stop stop-color="#4dd4ff"/><stop offset="1" stop-color="#1ea3ff"/></linearGradient></defs><path d="M12 2l8 4v6c0 5-3.5 8.5-8 10-4.5-1.5-8-5-8-10V6l8-4z" stroke="url(#g2)" stroke-width="2" fill="rgba(17,48,87,.55)"/></svg>
        </div>
      </div>
      <div>
        <h1>Camada de confiança do BagsApp</h1>
        <p class="ghost">Telemetria clara, defesa em profundidade e estabilidade de integrações. Status vivo + gráfico de confiabilidade para <code>/api/scan</code>, <code>/api/simulate</code> e Token Launch (Bags).</p>
        <div class="cta-row">
          <button id="btnHealth" class="btn btn-primary">Atualizar Status</button>
          <button id="btnPing" class="btn btn-ghost">Ping Bags (canário)</button>
          <button id="btnSecurity" class="btn btn-outline">Nota de segurança</button>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="card span-7">
        <h3>Painel de Confiabilidade (tempo real)</h3>
        <div class="reliability">
          <div class="donutwrap">
            <svg id="donut" width="230" height="230" viewBox="0 0 230 230" aria-hidden="true">
              <defs><linearGradient id="dg" x1="0" x2="1"><stop stop-color="#1ea3ff"/><stop offset="1" stop-color="#4dd4ff"/></linearGradient></defs>
              <circle cx="115" cy="115" r="92" stroke="#0b2142" stroke-width="24" fill="none"/>
              <circle id="donutArc" cx="115" cy="115" r="92" stroke="url(#dg)" stroke-width="24" fill="none" stroke-linecap="round" transform="rotate(-90 115 115)"/>
            </svg>
            <div style="position:absolute;inset:0;display:grid;place-items:center;text-align:center">
              <div><div class="donut-value" id="donutVal">0%</div><div class="donut-sub">Confiabilidade geral</div></div>
            </div>
          </div>
          <div>
            <div class="bar"><div class="name">Core API (health)</div><div class="track"><div id="b-core" class="fill" style="width:0%"></div></div><div class="pct" id="p-core">0%</div></div>
            <div class="bar"><div class="name">/api/scan</div><div class="track"><div id="b-scan" class="fill" style="width:0%"></div></div><div class="pct" id="p-scan">0%</div></div>
            <div class="bar"><div class="name">/api/simulate</div><div class="track"><div id="b-sim" class="fill" style="width:0%"></div></div><div class="pct" id="p-sim">0%</div></div>
            <div class="bar"><div class="name">Token Launch (Bags)</div><div class="track"><div id="b-bags" class="fill" style="width:0%"></div></div><div class="pct" id="p-bags">0%</div></div>
            <div class="bar"><div class="name">Shield Score Engine</div><div class="track"><div id="b-ssl" class="fill" style="width:0%"></div></div><div class="pct" id="p-ssl">0%</div></div>
            <div class="ghost" style="margin-top:6px">Shield Score = média da disponibilidade de <code>/scan</code> + <code>/simulate</code>.</div>
          </div>
        </div>
      </div>

      <div class="card span-5">
        <h3>Playground Rápido</h3>
        <div class="row">
          <input id="mint" placeholder="mint (simulate)" />
          <button id="btnSim" class="btn btn-primary">POST /api/simulate</button>
        </div>
        <div class="row" style="margin-top:8px">
          <textarea id="tx" rows="5" placeholder="rawTransaction (scan) — cole um JSON bruto ou texto"></textarea>
        </div>
        <div class="row" style="margin-top:8px">
          <button id="btnScan" class="btn btn-ghost">POST /api/scan</button>
          <button id="btnClear" class="btn btn-ghost">Limpar</button>
        </div>
        <div style="margin-top:12px">
          <pre id="outSim">{ }</pre>
          <div style="height:8px"></div>
          <pre id="outScan">{ }</pre>
        </div>
      </div>

      <div class="card span-7">
        <h3>Status da API</h3>
        <div class="row" style="gap:12px;flex-wrap:wrap">
          <span class="pill">/api/health: <span id="hStatus" class="badge b-warn">…</span></span>
          <span class="pill">/api/scan: <span id="sStatus" class="badge b-warn">…</span></span>
          <span class="pill">/api/simulate: <span id="mStatus" class="badge b-warn">…</span></span>
          <span class="pill">/api/bags/ping: <span id="pStatus" class="badge b-warn">…</span></span>
        </div>
        <div style="margin-top:12px"><pre id="healthOut" aria-live="polite">Clique em “Atualizar Status”.</pre></div>
      </div>

      <div class="card span-5">
        <h3>Deploy & Metadados</h3>
        <div style="display:grid;grid-template-columns:140px 1fr;gap:10px">
          <div class="ghost">RequestId</div><div id="kvReq">—</div>
          <div class="ghost">DeploymentId</div><div id="kvDep">—</div>
          <div class="ghost">Vercel-Id</div><div id="kvVer">—</div>
          <div class="ghost">RateLimit</div><div id="kvRl">—</div>
        </div>
      </div>
    </div>

    <div class="footer">© Bags Shield — navy/blue • CTAs azul escuro • responsivo</div>
  </div>

  <script>
    const $=(q)=>document.querySelector(q);
    const fmt=(d)=>{try{return JSON.stringify(d,null,2)}catch(e){return String(d)}};
    async function safeJson(res){try{return await res.json()}catch{return{success:false,error:"Conteúdo não-JSON",text:await res.text()}}}
    function badge(el,ok){el.className="badge "+(ok?"b-ok":"b-err");el.textContent=ok?"OK":"ERRO"}

    const R=92,CIRC=2*Math.PI*R;
    function setDonut(pct){
      const arc=$("#donutArc"); arc.setAttribute("stroke-dasharray",String(CIRC));
      const target=CIRC*(1-pct/100); arc.setAttribute("stroke-dashoffset",String(target));
      $("#donutVal").textContent=Math.round(pct)+"%";
    }
    function setBar(id,pct){$("#b-"+id).style.width=Math.max(0,Math.min(100,pct))+"%";$("#p-"+id).textContent=Math.round(pct)+"%"}

    async function head(url){const r=await fetch(url,{method:"HEAD"}).catch(()=>null);return r&&r.ok}
    async function pingHealth(){
      const res=await fetch("/api/health",{headers:{"Accept":"application/json"}}).catch(()=>null);
      if(!res){badge($("#hStatus"),false);$("#healthOut").textContent="Falha de rede";return{ok:false,headers:new Headers(),body:null}}
      const body=await safeJson(res); badge($("#hStatus"),res.ok); $("#healthOut").textContent=fmt(body);
      const rid=(body&&body.meta&&(body.meta.requestId||body.meta.request_id))||res.headers.get("x-request-id")||"—"; $("#kvReq").textContent=rid;
      return{ok:res.ok,headers:res.headers,body}
    }
    async function pingBags(){
      const el=$("#pStatus"); el.textContent="…"; el.className="badge b-warn";
      const res=await fetch("/api/bags/ping",{headers:{"Accept":"application/json"}}).catch(()=>null);
      if(!res){el.textContent="ERRO";el.className="badge b-err";return{ok:false,headers:new Headers(),body:null}}
      const body=await safeJson(res); el.textContent=res.ok?"OK":"ERRO"; el.className="badge "+(res.ok?"b-ok":"b-err");
      const m=(body&&body.meta)||{}; const rl=[m.rateLimitRemaining,m.rateLimitLimit].every(Boolean)?`${m.rateLimitRemaining}/${m.rateLimitLimit} (reset ${m.rateLimitReset||"?"})`:"—";
      $("#kvRl").textContent=rl; return{ok:res.ok,headers:res.headers,body}
    }
    async function getDeployMeta(){
      const r=await fetch("/",{method:"HEAD"}).catch(()=>null); if(!r) return;
      $("#kvDep").textContent=r.headers.get("x-deployment-id")||"—";
      $("#kvVer").textContent=r.headers.get("x-vercel-id")||r.headers.get("server")||"—";
    }
    async function checkAll(){
      const h=await pingHealth(); const scanOk=await head("/api/scan"); badge($("#sStatus"),scanOk);
      const simOk=await head("/api/simulate"); badge($("#mStatus"),simOk);
      const bags=await pingBags(); await getDeployMeta();
      const corePct=h.ok?100:0, scanPct=scanOk?100:0, simPct=simOk?100:0, bagsPct=bags.ok?100:0, sslPct=Math.round((scanPct+simPct)/2);
      const overall=Math.round(corePct*0.35+scanPct*0.20+simPct*0.20+bagsPct*0.15+sslPct*0.10);
      setBar("core",corePct); setBar("scan",scanPct); setBar("sim",simPct); setBar("bags",bagsPct); setBar("ssl",sslPct); setDonut(overall);
    }
    async function postJson(url,payload,out){
      out.textContent="POST "+url+" …";
      try{const res=await fetch(url,{method:"POST",headers:{"Content-Type":"application/json","Accept":"application/json"},body:JSON.stringify(payload)});
          const body=await safeJson(res); out.textContent=fmt(body)}catch(e){out.textContent=fmt({success:false,error:String(e)})}
    }

    // Logo fallback (marca imagem como quebrada se 404)
    document.querySelectorAll('.logoApp img, .heroIcon img').forEach(img=>{
      img.addEventListener('error',()=>img.setAttribute('aria-broken','1'),{once:true});
    });

    // Wireup
    $("#btnHealth").addEventListener("click",checkAll);
    $("#btnPing").addEventListener("click",pingBags);
    $("#btnSecurity").addEventListener("click",()=>alert("Nota de segurança já inclusa nos princípios do projeto. (Se quiser, converto para modal de markdown depois.)"));
    $("#btnSim").addEventListener("click",()=>postJson("/api/simulate",{mint:$("#mint").value.trim()},$("#outSim")));
    $("#btnScan").addEventListener("click",()=>postJson("/api/scan",{rawTransaction:$("#tx").value},$("#outScan")));
    $("#btnClear").addEventListener("click",()=>{ $("#outSim").textContent="{ }"; $("#outScan").textContent="{ }"; });

    checkAll(); setInterval(checkAll,10000);
  </script>
</body>
</html>